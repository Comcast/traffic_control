FROM centos:7

MAINTAINER Dan Kirkwood

RUN	yum -y install \
		epel-release \
		git \
		golang  \
		rpm-build && \
	yum -y clean all

# wait for clone to be available, then
# build the rpm and copy to /artifacts

RUN echo $'\n\
tc=/repo/traffic_control\n\
while [ ! -d $tc/traffic_ops ]; do sleep 1; done\n\
cd $tc/traffic_ops\n\
./build/build_rpm.sh\n\
mkdir -p /artifacts\n\
cp $tc/dist/* /artifacts/.\n\
' >/run.sh

CMD sh -x /run.sh
